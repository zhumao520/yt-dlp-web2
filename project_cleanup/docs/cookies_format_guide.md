# Cookies 格式转换完整指南

## 🔄 格式转换机制

### 支持的格式类型

1. **Netscape格式** (浏览器标准)
2. **JSON格式** (开发者工具)
3. **键值对格式** (简单格式)

---

## 📋 格式详解

### 1. Netscape格式 (.txt)
```
# Netscape HTTP Cookie File
# Generated by YT-DLP Web V2

.youtube.com	TRUE	/	FALSE	1735689600	VISITOR_INFO1_LIVE	CgtVc2VyVmlzaXRvcg
.youtube.com	TRUE	/	TRUE	1735689600	YSC	d2ViX3Nlc3Npb25faWQ
youtube.com	FALSE	/	FALSE	1735689600	PREF	tz=Asia.Shanghai&f4=4000000
```

**字段说明**：
- `domain`: 域名 (如 .youtube.com)
- `domain_specified`: 是否指定域名 (TRUE/FALSE)
- `path`: 路径 (通常是 /)
- `secure`: 是否HTTPS (TRUE/FALSE)
- `expiration`: 过期时间戳
- `name`: Cookie名称
- `value`: Cookie值

### 2. JSON格式 (.json)
```json
[
  {
    "name": "VISITOR_INFO1_LIVE",
    "value": "CgtVc2VyVmlzaXRvcg",
    "domain": ".youtube.com",
    "path": "/",
    "secure": false,
    "httpOnly": false,
    "sameSite": "None",
    "expirationDate": 1735689600
  },
  {
    "name": "YSC", 
    "value": "d2ViX3Nlc3Npb25faWQ",
    "domain": ".youtube.com",
    "path": "/",
    "secure": true,
    "httpOnly": true,
    "sameSite": "None",
    "expirationDate": 0
  }
]
```

### 3. 键值对格式
```
VISITOR_INFO1_LIVE=CgtVc2VyVmlzaXRvcg
YSC=d2ViX3Nlc3Npb25faWQ
PREF=tz=Asia.Shanghai&f4=4000000
```

---

## 🔧 转换流程

### 输入 → 统一格式 → 输出

```
任意格式 → 内部JSON结构 → Netscape格式 (供yt-dlp使用)
```

### 内部JSON结构
```json
{
  "website": "youtube",
  "format": "json",
  "cookies": [
    {
      "domain": ".youtube.com",
      "name": "VISITOR_INFO1_LIVE", 
      "value": "...",
      "path": "/",
      "secure": false,
      "expiration": 1735689600
    }
  ],
  "created_at": "2025-06-07T14:52:00.000Z",
  "updated_at": "2025-06-07T14:52:00.000Z",
  "count": 3
}
```

---

## 🌐 各平台获取方法

### YouTube
**关键Cookies**: `VISITOR_INFO1_LIVE`, `YSC`, `CONSENT`

**获取方法**:
1. 登录 youtube.com
2. F12 → Application → Cookies → youtube.com
3. 导出关键cookies

### Bilibili  
**关键Cookies**: `SESSDATA`, `bili_jct`, `DedeUserID`

**获取方法**:
1. 登录 bilibili.com
2. 使用浏览器扩展导出
3. 或手动复制关键cookies

### Twitter/X
**关键Cookies**: `auth_token`, `ct0`, `guest_id`

**获取方法**:
1. 登录 twitter.com 或 x.com
2. 导出所有cookies
3. 确保包含认证相关cookies

### Instagram
**关键Cookies**: `sessionid`, `csrftoken`, `ds_user_id`

**获取方法**:
1. 登录 instagram.com
2. 导出session相关cookies
3. 注意cookies有效期较短

### TikTok
**关键Cookies**: `sessionid`, `sid_tt`, `uid_tt`

**获取方法**:
1. 登录 tiktok.com
2. 导出用户session cookies
3. 可能需要定期更新

---

## 🛠️ 浏览器扩展推荐

### Chrome/Edge
- **EditThisCookie**: 最流行的cookies编辑器
- **Cookie-Editor**: 简单易用
- **Export Cookies**: 专门用于导出

### Firefox
- **Cookie-Editor**: Firefox版本
- **Cookies Manager+**: 功能丰富

### Safari
- **Web Developer**: 包含cookies功能
- 或使用开发者工具手动复制

---

## 📝 使用步骤

### 1. 获取Cookies

#### ⭐ 推荐方法：隐私浏览窗口（官方推荐）
```bash
# YouTube官方推荐的正确方法（避免cookies轮换）
1. 打开新的隐私浏览/无痕窗口
2. 在该窗口登录YouTube
3. 在同一个标签页中，导航到 https://www.youtube.com/robots.txt
4. 从浏览器导出 youtube.com 的cookies
5. 立即关闭隐私浏览窗口，确保会话不再被浏览器打开
```

#### 方法1: 浏览器扩展
```bash
1. 安装 EditThisCookie (推荐) 或 Cookie-Editor
2. 按照上述隐私浏览窗口步骤操作
3. 点击扩展图标
4. 选择 "Export" → "Netscape HTTP Cookie File"
```

#### 方法2: 开发者工具
```bash
1. 按照上述隐私浏览窗口步骤操作
2. F12 打开开发者工具
3. Application → Storage → Cookies
4. 选择目标域名
5. 复制所需cookies
```

### 2. 上传到系统
```bash
# 方法1: Web界面
1. 访问 /cookies 页面
2. 选择对应网站
3. 上传文件或粘贴内容

# 方法2: 命令行工具
python setup_youtube_cookies.py setup
```

### 3. 验证有效性
```bash
# 检查cookies状态
python setup_youtube_cookies.py check

# 或通过Web界面测试
点击 "测试" 按钮验证cookies有效性
```

---

## ⚠️ 注意事项

### 安全性
- 🔒 Cookies包含敏感信息，请妥善保管
- 🚫 不要分享给他人
- 🔄 定期更新过期的cookies
- ⚠️ 使用账户下载可能导致账户被封（临时或永久）

### 有效性
- ⏰ 大部分cookies有过期时间
- 🔄 登录状态变化会使cookies失效
- 📱 移动端和桌面端cookies可能不同
- 🔄 YouTube会频繁轮换cookies作为安全措施
- 🕐 导出的cookies在30分钟内最有效

### 兼容性
- ✅ 系统自动处理格式转换
- 🔧 支持多种字段名映射
- 🛠️ 自动修复常见格式问题

### YouTube特殊说明
- 🤖 YouTube正在强制使用PO Token
- 🔄 建议使用隐私浏览窗口导出cookies
- ⚡ 如遇持续问题，可能需要PO Token
- 🛡️ 考虑使用备用账户避免主账户风险

---

## 🚀 高级功能

### 批量管理
- 支持多网站cookies管理
- 批量测试有效性
- 批量导出/导入

### 自动修复
- 格式不一致自动修复
- 过期时间字段映射
- 域名规范化处理

### 调试功能
- 详细的转换日志
- 格式验证报告
- 错误诊断建议
