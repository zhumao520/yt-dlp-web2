# 📱 iOS快捷指令完整配置指南

## 🎯 功能说明

这个快捷指令可以让您：
- ✅ 从任何App复制视频链接
- ✅ 一键下载到iPhone文件App
- ✅ 支持YouTube、TikTok、B站等1000+网站
- ✅ 自动选择合适的视频质量
- ✅ 显示下载进度通知

## 🔧 前置准备

### 1. 获取服务器信息
在您的YT-DLP Web服务中：
1. 打开设置页面
2. 进入"安全设置"标签
3. 启用"API访问"
4. 点击"重新生成"获取API密钥
5. 进入"iOS快捷指令"标签
6. 复制服务器地址和API密钥

### 2. 需要的信息
- **服务器地址**: `http://your-server:8080`
- **API密钥**: `your_32_character_api_key`

## 📲 创建快捷指令步骤

### 第1步：创建新快捷指令
1. 打开iPhone上的"快捷指令"App
2. 点击右上角"+"号
3. 点击"添加操作"

### 第2步：添加操作（按顺序）

#### 操作1：获取剪贴板
- 搜索并添加"获取剪贴板"
- 无需设置

#### 操作2：设置变量
- 搜索并添加"设置变量"
- 变量名：`VideoURL`

#### 操作3：获取URL内容（下载请求）
- 搜索并添加"获取URL内容"
- **方法**：`POST`
- **URL**：`http://your-server:8080/api/shortcuts/download`
- **请求体**：选择"JSON"
- **JSON内容**：
```json
{
  "url": "VideoURL",
  "quality": "medium",
  "api_key": "your_32_character_api_key"
}
```

#### 操作4：从输入获取值
- 搜索并添加"从输入获取值"
- **获取**：`download_id`
- **设置变量名**：`DownloadID`

#### 操作5：显示通知
- 搜索并添加"显示通知"
- **标题**：`下载开始`
- **正文**：`正在下载视频，请稍候...`

#### 操作6：重复（状态检查循环）
- 搜索并添加"重复"
- **重复次数**：`30`

在重复操作内部添加以下子操作：

##### 子操作6.1：获取URL内容（状态查询）
- **方法**：`GET`
- **URL**：`http://your-server:8080/api/shortcuts/status/DownloadID`

##### 子操作6.2：从输入获取值（状态）
- **获取**：`status`
- **设置变量名**：`Status`

##### 子操作6.3：从输入获取值（进度）
- **获取**：`progress`
- **设置变量名**：`Progress`

##### 子操作6.4：如果（检查完成）
- 搜索并添加"如果"
- **条件**：`Status` **等于** `completed`

在"如果"的"否则"部分添加：
- **等待**：`3秒`

在"如果"的"那么"部分添加：
- **从输入获取值**：获取`download_url`，变量名`FileURL`
- **从输入获取值**：获取`filename`，变量名`FileName`
- **退出快捷指令**

#### 操作7：获取URL内容（下载文件）
- **方法**：`GET`
- **URL**：`http://your-server:8080FileURL`

#### 操作8：存储到文件
- 搜索并添加"存储到文件"
- **询问存储位置**：开启
- **覆盖现有文件**：关闭

#### 操作9：显示通知（完成）
- **标题**：`下载完成`
- **正文**：`视频已保存到文件App`

### 第3步：设置快捷指令
1. 点击右上角"下一步"
2. **名称**：`YT-DLP视频下载`
3. **图标**：选择下载图标
4. **颜色**：选择蓝色
5. 点击"完成"

## 🎮 使用方法

### 方法1：从其他App分享
1. 在Safari、YouTube、TikTok等App中
2. 点击"分享"按钮
3. 选择"快捷指令"
4. 选择"YT-DLP视频下载"

### 方法2：复制链接后运行
1. 复制视频链接到剪贴板
2. 在快捷指令App中点击"YT-DLP视频下载"
3. 或者通过Siri说"YT-DLP视频下载"

### 方法3：添加到主屏幕
1. 长按快捷指令
2. 选择"添加到主屏幕"
3. 直接从主屏幕运行

## 🔧 高级配置

### 自定义质量选择
在操作3的JSON中修改`quality`值：
- `"best"` - 最高质量
- `"medium"` - 中等质量（推荐）
- `"low"` - 低质量（省流量）

### 仅下载音频
在操作3的JSON中添加：
```json
{
  "url": "VideoURL",
  "quality": "medium",
  "audio_only": true,
  "api_key": "your_32_character_api_key"
}
```

### 添加质量选择菜单
在操作2后添加：
- **从菜单中选择**
- 选项：`最高质量`、`中等质量`、`低质量`
- 变量名：`SelectedQuality`

然后在操作3的JSON中使用：`"quality": "SelectedQuality"`

## 🚨 故障排除

### 常见问题

#### 1. "无法连接到服务器"
- 检查服务器地址是否正确
- 确保服务器正在运行
- 检查网络连接

#### 2. "API密钥无效"
- 重新生成API密钥
- 确保复制完整的32位密钥
- 检查JSON格式是否正确

#### 3. "下载失败"
- 检查视频链接是否有效
- 某些网站可能需要特殊处理
- 查看服务器日志获取详细错误

#### 4. "文件保存失败"
- 检查iPhone存储空间
- 确保有文件App的写入权限

### 调试技巧

#### 查看详细错误
在操作6.4的"如果"中添加检查失败状态：
- **条件**：`Status` **等于** `failed`
- **那么**：显示通知，内容为错误信息

#### 显示下载进度
在操作6.3后添加：
- **显示通知**
- **标题**：`下载进度`
- **正文**：`Progress%`

## 🎉 完成！

现在您可以：
1. ✅ 从任何App一键下载视频
2. ✅ 自动保存到文件App
3. ✅ 支持1000+视频网站
4. ✅ 获得下载进度通知

**享受便捷的视频下载体验！** 🚀📱
